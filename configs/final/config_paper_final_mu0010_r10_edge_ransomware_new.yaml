# Paper-final (train + all metrics for the article) â€” edge_ransomware_new
#
# Uses a stronger dataset variant that:
#   - has multiple attacked Src IPs
#   - has better temporal overlap between benign and ransomware periods
#
# This config:
#   1) runs preprocessing with a separate benign calibration split
#   2) runs federated training (10 rounds)
#   3) runs oracle evaluation (f1_max)
#   4) runs operational evaluation (fpr_target) + temporal metrics (TTD/coverage), flow + windowed
#
# Run:
#   ./.venv/bin/python main.py --config configs/final/config_paper_final_mu0010_r10_edge_ransomware_new.yaml

simulation_name: "FINAL_PAPER_EDGE_NEW_LoRA16_FedProx_0010_Orig_R10"
dataset_name: "edge_ransomware_new"
description: "Paper final (edge_ransomware_new): SmolLM-135M + LoRA16 + FedProx(mu=0.001), 10 rounds, oracle + operational eval."

data_base_path: "./data/ids_ransomware/"
results_path: "./results/"

session_window_spliter: " ;-; "
force_reprocess_data: true

# Train benign-only, plus a separate benign-only calibration split for operational thresholding.
benign_train_fraction: 0.8
benign_train_cap: 50000
benign_calibration_fraction: 0.1
processed_required_files: ["train.csv", "calibration.csv", "test.csv"]
test_balance: true
test_balance_seed: 42

content_mode: "raw"

# Recommended for scientific rigor in device-based temporal metrics:
# keep only real IPv4 devices (drops IPv6 link-local and 0.0.0.0 placeholders).
filter_ipv4_only: true
drop_zero_ips: true

model_name: "HuggingFaceTB/SmolLM-135M"
lora: True
lora_rank: 16
lora_alpha_multiplier: 4
lora_dropout: 0.1

use_parallel_training: false
num_rounds: 10
num_clients: 50
client_frac: 0.2

data_distribution_strategy: "hetero_device"
non_iid_alpha: 0.5

client_selection_strategy: "data_size_proportional"
use_weighted_aggregation: true

fedprox_mu: 0.001

max_steps: 50
batch_size: 4
gradient_accumulation_steps: 16
initial_lr: 0.0003
min_lr: 0.00001
lr_scheduler_type: "cosine"

top_k_values: [1, 3, 5, 10]
f1_threshold_steps: 1000

# Default evaluation (oracle)
threshold_selection: "f1_max"
evaluator_version: "new"
accuracy_method: "original"

evaluation_runs:
  - name: "operational_fpr_target_flow"
    overrides:
      evaluation_output_dir: "./results/FINAL_PAPER_EDGE_NEW_LoRA16_FedProx_0010_Orig_R10/eval_fpr_target_flow"
      threshold_selection: "fpr_target"
      fpr_target: 0.01
      calibration_source: "calibration_benign"
      calibration_num_samples: 2000
      enable_temporal_metrics: true
      temporal_eval_mode: "flow"
  - name: "operational_fpr_target_window_30s"
    overrides:
      evaluation_output_dir: "./results/FINAL_PAPER_EDGE_NEW_LoRA16_FedProx_0010_Orig_R10/eval_fpr_target_window30s"
      threshold_selection: "fpr_target"
      fpr_target: 0.01
      calibration_source: "calibration_benign"
      calibration_num_samples: 2000
      enable_temporal_metrics: true
      temporal_eval_mode: "window"
      temporal_window_seconds: 30
      temporal_window_agg: "mean"
